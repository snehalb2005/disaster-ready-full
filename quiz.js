(function(){ const startBtn=document.getElementById('startBtn'); const quizContent=document.getElementById('quizContent'); const questionEl=document.getElementById('question'); const answersEl=document.getElementById('answers'); const feedbackEl=document.getElementById('feedback'); const tryAgainContainer=document.getElementById('tryAgainContainer'); const nextBtn=document.getElementById('nextBtn'); const exitBtn=document.getElementById('exitBtn'); const resultsSummary=document.getElementById('resultsSummary'); const flowerBlast=document.getElementById('flowerBlast'); const questions=[{question:'What should you do when ground shakes?',answers:[{text:'Run outside immediately',correct:false},{text:'Drop, Cover and Hold On',correct:true},{text:'Stand near window',correct:false},{text:'Use elevator',correct:false}]},{question:'Where should you go during a flood?',answers:[{text:'Low ground',correct:false},{text:'Higher ground or upstairs',correct:true},{text:'Basement',correct:false},{text:'Near electrical appliances',correct:false}]}]; let curIndex=0,attended=0,correctCount=0,wrongCount=0,answered=false,flowerInterval=null; function saveScore(){ const email=localStorage.getItem('studentEmail'); if(!email) return; const scores=JSON.parse(localStorage.getItem('studentScores')||'{}'); scores[email]=scores[email]||{score:0,attended:0,correct:0,wrong:0,lessons:[]}; scores[email].attended=attended; scores[email].correct=correctCount; scores[email].wrong=wrongCount; scores[email].score=attended?Math.round(100*correctCount/attended):0; localStorage.setItem('studentScores',JSON.stringify(scores)); } function reset(){curIndex=0;attended=0;correctCount=0;wrongCount=0;answered=false;resultsSummary.style.display='none'} startBtn&&(startBtn.onclick=function(){startBtn.style.display='none';quizContent.style.display='flex';nextBtn.style.display='none';exitBtn.style.display='inline-block';resultsSummary.style.display='none';reset();loadQuestion();}); nextBtn&&(nextBtn.onclick=function(){if(!answered){alert('Answer first');return;}curIndex++;if(curIndex>=questions.length)showResults();else loadQuestion();}); exitBtn&&(exitBtn.onclick=function(){showResults(true);}); function loadQuestion(){attended=Math.max(attended,curIndex+1);feedbackEl.innerHTML='';tryAgainContainer.innerHTML='';nextBtn.style.display='none';stopFlowers();answered=false;clearAnswers(); const q=questions[curIndex]; questionEl.textContent=q.question; answersEl.innerHTML=''; q.answers.forEach(ans=>{const b=document.createElement('button');b.className='quiz-answer-btn';b.textContent=ans.text;b.onclick=()=>handleAnswer(b,ans.correct);answersEl.appendChild(b);});} function handleAnswer(btn,isCorrect){ if(answered) return; answered=true; disableAnswers(); if(isCorrect){correctCount++; btn.classList.add('correct-answer'); feedbackEl.innerHTML='<span style="font-size:2rem;color:green;font-weight:800">✔</span>'; nextBtn.style.display=(curIndex===questions.length-1)?'none':'inline-block'; } else { wrongCount++; btn.classList.add('wrong-answer'); feedbackEl.innerHTML='<span style="color:#b71c1c;font-weight:700;font-size:2rem">❌</span>'; const tryAgain=document.createElement('button');tryAgain.className='btn btn-ghost';tryAgain.textContent='Try Again';tryAgain.onclick=()=>{feedbackEl.innerHTML='';tryAgainContainer.innerHTML='';clearAnswers();enableAnswers();wrongCount--;answered=false;}; const next=document.createElement('button'); next.className='btn btn-primary'; next.textContent='Next'; next.onclick=()=>{curIndex++; if(curIndex>=questions.length) showResults(); else loadQuestion();}; tryAgainContainer.appendChild(tryAgain); tryAgainContainer.appendChild(next); } } function disableAnswers(){Array.from(answersEl.children).forEach(b=>b.disabled=true);} function enableAnswers(){Array.from(answersEl.children).forEach(b=>b.disabled=false);} function clearAnswers(){Array.from(answersEl.children).forEach(b=>{b.className='';b.disabled=false;const c=b.querySelector('.checkmark-span'); if(c) c.remove();});} function stopFlowers(){ if(flowerInterval){clearInterval(flowerInterval);flowerInterval=null;} Array.from(flowerBlast.children).forEach(ch=>ch.remove()); flowerBlast.style.display='none'; } function showResults(exited=false){ stopFlowers(); quizContent.style.display='none'; feedbackEl.innerHTML=''; tryAgainContainer.innerHTML=''; nextBtn.style.display='none'; exitBtn.style.display='none'; answersEl.innerHTML=''; questionEl.textContent=exited?'Quiz Exited':'Quiz Completed!'; resultsSummary.style.display='block'; resultsSummary.innerHTML='<h2>'+ (exited? 'You Exited The Quiz' : 'Quiz Completed!') +'</h2><p>Total Attended: <strong>'+attended+'</strong></p><p>Total Correct: <strong>'+correctCount+'</strong></p><p>Total Wrong: <strong>'+wrongCount+'</strong></p>'; saveScore(); } })();